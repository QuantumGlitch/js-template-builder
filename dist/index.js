!function(t,e){for(var a in e)t[a]=e[a];e.__esModule&&Object.defineProperty(t,"__esModule",{value:!0})}(exports,(()=>{var t={729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,a="~";function n(){}function r(t,e,a){this.fn=t,this.context=e,this.once=a||!1}function i(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(a=!1)),i.prototype.eventNames=function(){var t,n,r=[];if(0===this._eventsCount)return r;for(n in t=this._events)e.call(t,n)&&r.push(a?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},i.prototype.listeners=function(t,e){var n=a?a+t:t,r=this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},i.prototype.emit=function(t,e,n,r,i,s){var o=a?a+t:t;if(!this._events[o])return!1;var u,c,l=this._events[o],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,i),!0;case 6:return l.fn.call(l.context,e,n,r,i,s),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var p,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,n);break;case 4:l[c].fn.call(l[c].context,e,n,r);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];l[c].fn.apply(l[c].context,u)}}return!0},i.prototype.on=function(t,e,n){var i=new r(e,n||this),s=a?a+t:t;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):(this._events[s]=i,this._eventsCount++),this},i.prototype.once=function(t,e,n){var i=new r(e,n||this,!0),s=a?a+t:t;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):(this._events[s]=i,this._eventsCount++),this},i.prototype.removeListener=function(t,e,r,i){var s=a?a+t:t;if(!this._events[s])return this;if(!e)return 0==--this._eventsCount?this._events=new n:delete this._events[s],this;var o=this._events[s];if(o.fn)o.fn!==e||i&&!o.once||r&&o.context!==r||(0==--this._eventsCount?this._events=new n:delete this._events[s]);else{for(var u=0,c=[],l=o.length;u<l;u++)(o[u].fn!==e||i&&!o[u].once||r&&o[u].context!==r)&&c.push(o[u]);c.length?this._events[s]=1===c.length?c[0]:c:0==--this._eventsCount?this._events=new n:delete this._events[s]}return this},i.prototype.removeAllListeners=function(t){var e;return t?(e=a?a+t:t,this._events[e]&&(0==--this._eventsCount?this._events=new n:delete this._events[e])):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=a,i.EventEmitter=i,t.exports=i},857:(t,e,a)=>{"use strict";function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var r=a(729),i=function(){},s={data:"state-data",cdata:"state-cdata",tagBegin:"state-tag-begin",tagName:"state-tag-name",tagEnd:"state-tag-end",attributeNameStart:"state-attribute-name-start",attributeName:"state-attribute-name",attributeNameEnd:"state-attribute-name-end",attributeValueBegin:"state-attribute-value-begin",attributeValue:"state-attribute-value"},o={lt:"action-lt",gt:"action-gt",space:"action-space",equal:"action-equal",quote:"action-quote",slash:"action-slash",char:"action-char",error:"action-error"},u={text:"text",openTag:"open-tag",closeTag:"close-tag",attributeName:"attribute-name",attributeValue:"attribute-value"},c={" ":o.space,"\t":o.space,"\n":o.space,"\r":o.space,"<":o.lt,">":o.gt,'"':o.quote,"'":o.quote,"=":o.equal,"/":o.slash};t.exports={State:s,Action:o,Type:u,create:function(t){var e,a,l,h,p,f,d,v,b,m;t=Object.assign({debug:!1},t);var y=new r,g=s.data,x="",V="",_="",w="",N="",E="",$=function(e,a){if("?"!==V[0]&&"!"!==V[0]){var n={type:e,value:a};t.debug&&console.log("emit:",n),y.emit("data",n)}};y.stateMachine=(n(m={},s.data,(n(e={},o.lt,(function(){x.trim()&&$(u.text,x),V="",N=!1,g=s.tagBegin})),n(e,o.char,(function(t){x+=t})),e)),n(m,s.cdata,n({},o.char,(function(t){"]]>"===(x+=t).substr(-3)&&($(u.text,x.slice(0,-3)),x="",g=s.data)}))),n(m,s.tagBegin,(n(a={},o.space,i),n(a,o.char,(function(t){V=t,g=s.tagName})),n(a,o.slash,(function(){V="",N=!0})),a)),n(m,s.tagName,(n(l={},o.space,(function(){N?g=s.tagEnd:(g=s.attributeNameStart,$(u.openTag,V))})),n(l,o.gt,(function(){$(N?u.closeTag:u.openTag,V),x="",g=s.data})),n(l,o.slash,(function(){g=s.tagEnd,$(u.openTag,V)})),n(l,o.char,(function(t){"![CDATA["===(V+=t)&&(g=s.cdata,x="",V="")})),l)),n(m,s.tagEnd,(n(h={},o.gt,(function(){$(u.closeTag,V),x="",g=s.data})),n(h,o.char,i),h)),n(m,s.attributeNameStart,(n(p={},o.char,(function(t){_=t,g=s.attributeName})),n(p,o.gt,(function(){x="",g=s.data})),n(p,o.space,i),n(p,o.slash,(function(){N=!0,g=s.tagEnd})),p)),n(m,s.attributeName,(n(f={},o.space,(function(){g=s.attributeNameEnd})),n(f,o.equal,(function(){$(u.attributeName,_),g=s.attributeValueBegin})),n(f,o.gt,(function(){w="",$(u.attributeName,_),$(u.attributeValue,w),x="",g=s.data})),n(f,o.slash,(function(){N=!0,w="",$(u.attributeName,_),$(u.attributeValue,w),g=s.tagEnd})),n(f,o.char,(function(t){_+=t})),f)),n(m,s.attributeNameEnd,(n(d={},o.space,i),n(d,o.equal,(function(){$(u.attributeName,_),g=s.attributeValueBegin})),n(d,o.gt,(function(){w="",$(u.attributeName,_),$(u.attributeValue,w),x="",g=s.data})),n(d,o.char,(function(t){w="",$(u.attributeName,_),$(u.attributeValue,w),_=t,g=s.attributeName})),d)),n(m,s.attributeValueBegin,(n(v={},o.space,i),n(v,o.quote,(function(t){E=t,w="",g=s.attributeValue})),n(v,o.gt,(function(){$(u.attributeValue,w=""),x="",g=s.data})),n(v,o.char,(function(t){E="",w=t,g=s.attributeValue})),v)),n(m,s.attributeValue,(n(b={},o.space,(function(t){E?w+=t:($(u.attributeValue,w),g=s.attributeNameStart)})),n(b,o.quote,(function(t){E===t?($(u.attributeValue,w),g=s.attributeNameStart):w+=t})),n(b,o.gt,(function(t){E?w+=t:($(u.attributeValue,w),x="",g=s.data)})),n(b,o.slash,(function(t){E?w+=t:($(u.attributeValue,w),N=!0,g=s.tagEnd)})),n(b,o.char,(function(t){w+=t})),b)),m);var C=function(e){t.debug&&console.log(g,e);var a=y.stateMachine[g];(a[function(t){return c[t]||o.char}(e)]||a[o.error]||a[o.char])(e)};return y.write=function(t){for(var e=t.length,a=0;a<e;a++)C(t[a])},y}}},670:(t,e,a)=>{"use strict";var n=a(729),r=a(857),i=r.Type,s={element:"element",text:"text"},o=function(t){return Object.assign({name:"",type:s.element,value:"",parent:null,attributes:{},children:[]},t)},u=function(t){t=Object.assign({stream:!1,parentNodes:!0,doneEvent:"done",tagPrefix:"tag:",emitTopLevelOnly:!1,debug:!1},t);var e=void 0,a=void 0,u=void 0,c=void 0,l=new n,h=function(n){switch(n.type){case i.openTag:if(null===u)(u=a).name=n.value;else{var r=o({name:n.value,parent:u});u.children.push(r),u=r}break;case i.closeTag:var h=u.parent;if(t.parentNodes||(u.parent=null),u.name!==n.value)break;t.stream&&h===a&&(a.children=[],u.parent=null),t.emitTopLevelOnly&&h!==a||(l.emit(t.tagPrefix+u.name,u),l.emit("tag",u.name,u)),u===a&&(e.removeAllListeners("data"),l.emit(t.doneEvent,u),a=null),u=h;break;case i.text:u&&u.children.push(o({type:s.text,value:n.value,parent:t.parentNodes?u:null}));break;case i.attributeName:c=n.value,u.attributes[c]="";break;case i.attributeValue:u.attributes[c]=n.value}};return l.reset=function(){(e=r.create({debug:t.debug})).on("data",h),a=o(),u=null,c="",l.parse=e.write},l.reset(),l};t.exports={parseSync:function(t,e){e=Object.assign({},e,{stream:!1,tagPrefix:":"});var a=u(e),n=void 0;return a.on("done",(function(t){n=t})),a.parse(t),n},create:u,NodeType:s}},784:(t,e,a)=>{const{ModelDefinition:n,ModelNodeDefinition:r}=a(827),{Variable:i}=a(579),{ControlExpression:s}=a(681);class o{constructor({parent:t,controlExpression:e}={}){this.children=[],this.parent=t,this.controlExpression=e,this.variables=[]}get parent(){return this._parent}set parent(t){this.parent!==t&&(this.parent&&(this.parent.children=this.parent.children.filter((t=>t!==this))),t&&(t.children.push(this),this._parent=t))}addChild(t){t.parent=this}validate(){return this.variables=[],!this.controlExpression||!!this.controlExpression.validate({context:this})&&(this.variables=[...this.variables,...this.controlExpression.newVariables()],!0)}render({innerRender:t}){return this.controlExpression?this.controlExpression.render({innerRender:t}):t()}upsearchVar(t){let e=t.split(".");const a=e.shift();let n=this.parent,r=null;for(;n&&!r;)r=n.searchVarByName(a),n=n.parent;return r?r.getByPath(e):null}searchVar(t){let e=t.split(".");const a=e.shift(),n=this.variables.find((t=>t.name===a));return n?n.getByPath(e):null}searchVarByName(t){return this.variables.find((e=>e.name===t))}}t.exports={RootContext:class extends o{constructor({modelDefinition:t}){super({}),this.variables=t.props}get parent(){return null}set parent(t){}bind(t){this.variables.forEach((e=>e.bind(t[e.name])))}upsearchVar(){return null}},Context:o}},827:t=>{class e{constructor({name:t,description:e=null,type:a,props:n=null}){this.name=t,this.description=e,this._type=a,this._props=n,this.value=void 0}bind(t){this.value=t,"Object"===this.type&&"object"==typeof t&&t&&this.props.forEach((e=>e.bind(t[e.name])))}static parseFromRawObject(t){const a=new e({name:t.name,description:t.description,type:t.type});return t.props&&(a.props=t.props.map((t=>e.parseFromRawObject(t)))),a}get type(){return this._type}set type(t){this._type=t}get props(){return this._props}set props(t){this._props=t}getByPath(t){let e=this;for(let a=0;a<t.length&&(e=e.props.find((e=>e.name===t[a])),e);a++);return e}}class a extends e{constructor({type:t,props:e}){super({type:t,props:e})}static parseFromRawObject(t){const n=new a({type:t.type});return t.props&&(n.props=t.props.map((t=>e.parseFromRawObject(t)))),n}}t.exports={ModelNodeDefinition:e,ModelDefinition:a,Type:{Object:"Object",Array:"Array",Primitive:"Primitive"}}},579:(t,e,a)=>{const{ModelNodeDefinition:n,Type:r}=a(827);t.exports={Variable:class extends n{constructor({name:t,description:e=null,type:a=null,props:n=null}={}){super({name:t,description:e,type:a,props:n})}}}},681:(t,e,a)=>{const{Expression:n,Type:r,GlobalRegex:i}=a(993),{Variable:s}=a(579),{Type:o}=a(827),u={If:"@if\\s+"+i.Identifier.Path,Foreach:`@foreach\\s+${i.Identifier.Name}\\s+of\\s+${i.Identifier.Path}`};t.exports={ControlExpression:class extends n{validateSyntax(){let t=null;if(!this.value)return!0;if(t=this.value.match(new RegExp(`^\\s*${u.Foreach}\\s*$`)))this.match=t,this.type=r.Foreach;else{if(!(t=this.value.match(new RegExp(`^\\s*${u.If}\\s*$`))))return!1;this.match=t,this.type=r.If}return!0}validateSemantic({context:t}){switch(this.description=null,this.type){case r.Foreach:if(this.iterator=this.validateVariablePath(this.match[2],t),!this.iterator)return;if(this.iterator.type!==o.Array)return void(this.error=`Can't use the instruction '@foreach' on '${this.match[2]}'. The type is not 'Array'.`);this.description=`Repeat the block below for each element of '${this.iterator.description}', where the current element is '${this.match[1]}'.`;break;case r.If:if(this.variable=this.validateVariablePath(this.match[1],t),!this.variable)return;this.description=`Continue with the block below, if the variable or property '${this.match[1]}' is true or has a value.`}return!0}newVariables(){const t=[];switch(this.type){case r.Foreach:const e=new s({name:this.match[1],type:this.iterator.props?"Object":"Primive",props:this.iterator.props,description:`Element of '${this.iterator.description}'`});t.push(e),this.iteratorVariable=e}return t}render({innerRender:t}){switch(this.type){case r.Foreach:return this.iterator.value?this.iterator.value.map((e=>(this.iteratorVariable.bind(e),t()))):null;case r.If:return null!==this.variable.value&&void 0!==this.variable.value&&!1!==this.variable.value?t():null}return t()}},Regex:u}},993:(t,e,a)=>{const{Type:n,ModelNodeDefinition:r}=a(827),{Variable:i}=a(579),{Context:s}=a(784),o={sum:{function:(...t)=>t.reduce(((t,e)=>t+e),0),returns:{type:n.Primitive,description:"Result of a sum"}},subtract:{function:(t,...e)=>e.reduce(((t,e)=>t-e),t),returns:{type:n.Primitive,description:"Result of a subtraction"}},multiply:{function:(...t)=>t.reduce(((t,e)=>t*e),1),returns:{type:n.Primitive,description:"Result of a multiplication"}},divide:{function:(t,...e)=>e.reduce(((t,e)=>t/e),t),returns:{type:n.Primitive,description:"Result of a division"}}},u={VariableValue:"VariableValue",StaticValue:"StaticValue",FunctionCallValue:"FunctionCallValue",Declaration:"Declaration",If:"If",Foreach:"Foreach"},c={Static:{String:'"([^"\\\\]*(?:\\\\[\\s\\S][^"\\\\]*)*)"',Number:"\\d+(.\\d+){0,1}"},Identifier:{Name:"([$A-Za-z_][0-9A-Za-z_$]*)",Path:"(([$A-Za-z_][0-9A-Za-z_$]*)(\\.[$A-Za-z_][0-9A-Za-z_$]*)*)"}};c.FunctionCall=c.Identifier.Name+"\\((.*)\\)",c.Declaration=c.Identifier.Name+"\\s*=\\s*(.*)";class l{constructor({value:t}={}){this.value=t,this.error=null,this.description=null}validateVariablePath(t,e){const a=e.searchVar(t)||e.upsearchVar(t);return a||(this.error=`Can't find the variable or property '${t}'.`),a}validateSyntax(){let t=null;if(t=this.value.match(new RegExp(`^\\s*${c.Static.String}\\s*$`)))this.match=t,this.type=u.StaticValue,this.staticValue=t[1].replace('\\"','"');else if(t=this.value.match(new RegExp(`^\\s*${c.Static.Number}\\s*$`)))this.match=t,this.type=u.StaticValue,this.staticValue=Number(this.match[1]);else if(t=this.value.match(new RegExp(`^\\s*${c.Identifier.Path}\\s*$`)))this.match=t,this.type=u.VariableValue;else if(t=this.value.match(new RegExp(`^\\s*${c.FunctionCall}\\s*$`)))this.match=t,this.type=u.FunctionCallValue;else{if(!(t=this.value.match(new RegExp(`^\\s*${c.Declaration}\\s*$`))))return!1;this.match=t,this.type=u.Declaration}return!0}validateSemantic({context:t}){switch(this.type){case u.VariableValue:const e=this.validateVariablePath(this.match[1],t);if(!e)return!1;this.variable=e;break;case u.FunctionCallValue:const a=this.match[1];if(!o[a])return this.error=`Can't find the function '${a}'`,!1;{const e=this.match[2].split(","),n=[];for(let a=0;a<e.length;a++){const r=new l({value:e[a]});if(!r.validate({context:t}))return this.error=`Can't validate the parameter << ${e[a]} >>  << ${r.error?r.error:""} >>`,!1;n.push(r)}this.functionName=a,this.parameters=n}break;case u.Declaration:const n=new l({value:this.match[2]});if(!n.validate({context:t}))return this.error=`Can't validate the value << ${this.match[2]} >> << ${n.error?n.error:""} >>`,!1;const r=n.deduceDataType(),s=new i({name:this.match[1],type:r.type,props:r.props,description:r.description});s.value=n.evaluate(),t.variables.push(s)}return!0}validate({context:t}){return this.validateSyntax()&&this.validateSemantic({context:t})}deduceDataType(){return this.type===u.FunctionCallValue?(t=o[this.functionName].returns)===n.Primitive?{type:n.Primitive}:t:this.type===u.VariableValue?this.variable:{type:n.Primitive};var t}evaluate(){switch(this.type){case u.StaticValue:return this.staticValue;case u.VariableValue:return this.variable.value;case u.FunctionCallValue:return o[this.functionName].function(...this.parameters.map((t=>t.evaluate())))}}render(){return this.evaluate()}}t.exports={Expression:l,Type:u,GlobalRegex:c,Functions:o}},138:(t,e,a)=>{t.exports={...a(827),...a(579),...a(784),...a(993),...a(681),Renderer:{...a(479)}}},479:(t,e,a)=>{const n=a(670),{ModelDefinition:r}=a(827),{Expression:i}=a(993),{ControlExpression:s}=a(681),{RootContext:o,Context:u}=a(784);function c(t,e){return!(!t.attributes||!t.attributes.class)&&t.attributes.class.split(" ").indexOf(e)>-1}function l(t){return`![ Error: << ${t.value.trim()} >> is not valid: ${t.error||"Generic Error."} ]\n`}function h(t,e){return t.children.map((t=>f(t,e))).filter((t=>null!=t)).join("")}function p(t){return t.replace(/\r?\n|\r/g,"").replace(/\s+/g," ")}function f(t,e){if(c(t,"data-context")){const a=new s({value:p(t.children[0].children[0].value)}),n=new u({parent:e,controlExpression:a});if(!n.validate())return l(n.controlExpression);const r=n.render({innerRender:()=>f(t.children[1],n)});return null==r?"":r instanceof Array?r.join(""):r}if(c(t,"data-declaration")){const a=new i({value:p(t.children[0].value)});if(!a.validate({context:e}))return l(a)}else{if(c(t,"data-expression")){const a=new i({value:p(t.children[0].value)});return a.validate({context:e})?a.render():l(a)}if(c(t,"data-content"))return h(t,e);if("element"===t.type)return`<${t.name}${function(t){return t.attributes&&Object.keys(t.attributes).length>0?" "+Object.keys(t.attributes).map((e=>`${e}="${t.attributes[e]}"`)).join(""):""}(t)}>${h(t,e)}</${t.name}>`;if("text"===t.type)return t.value}}t.exports={parseFromXml:function(t,e,a){return new Promise(((r,i)=>{try{const i=n.create();i.on("done",(a=>{const n=new o({modelDefinition:t});n.bind(e),r(f(a,n))})),i.parse(a)}catch(t){i(t)}}))}}}},e={};return function a(n){if(e[n])return e[n].exports;var r=e[n]={exports:{}};return t[n](r,r.exports,a),r.exports}(138)})());